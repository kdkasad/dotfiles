#!/bin/sh

#
# This script will compile various document formats into a PDF with the same basename
#

[ $# -lt 1 ] && exit 1

file="$(readlink -f "$1")"
ext="${file##*.}"
base="${file%.*}"
outfile="$base.pdf"

[ -n "$2" ] \
	&& out="$2" \
	|| out="$base.pdf"

groffopts="-mpdfmark -kpt -d paper=letter -P -pletter"

case "$ext" in
	ms) refer -PSep "${REFER_SOURCES:-$HOME/documents/sources.refer}" "$file" | pdfroff -ms $groffopts - > "$outfile" ;;
	mom) refer -PSep "${REFER_SOURCES:-$HOME/documents/sources.refer}" "$file" | pdfmom > "$outfile" ;;
	[0-9]|[0-9].in) groff -mandoc -T pdf -dpaper=letter -P-pletter "$file" > "$outfile" ;;
	*) refer -PSep "${REFER_SOURCES:-$HOME/documents/sources.refer}" "$file" | pdfroff $groffopts > "$outfile" ;;
esac
