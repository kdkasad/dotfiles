#!/bin/sh

kirc="${KIRC:-kirc}"

fn() {
	server="${SERVER:-irc.freenode.net:6697}"
	nick="$NICK"
	channels="$CHANNELS"
	cert_path="${CERT_PATH:-${XDG_DATA_HOME:-$HOME/.local/share}/irc.pem}"
}

test -f "$HOME/.config/kircw/config" && . "$HOME/.config/kircw/config"

if [ -n "$1" ]; then
	eval "$1"
	shift
else
	fn
fi

socat tcp-listen:6667,reuseaddr,fork,bind=127.0.0.1 ssl:"$server",cert="$cert_path" &

sleep 0.1

"$kirc" -s 127.0.0.1 -n "$nick" -e -c "$channels" "$@"

kill $!
