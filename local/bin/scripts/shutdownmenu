#!/bin/sh

lines=6

target="$(bemenu -p "choose state:" "$@" << eof || printf 'cancelled'
power off
reboot
suspend
hibernate
hybrid sleep
suspend then hibernate
eof
)"

case "$target" in
	*cancelled) exit 1 ;;
esac

case "$target" in
	suspend|hibernate|"hybrid sleep"|"suspend then hibernate")
		lockfirst="$( printf "yes\nno" | bemenu -p "lock first?" "$@" || printf cancelled )"
		;;
esac

echo "$lockfirst" | grep cancelled >/dev/null 2>&1 \
	&& exit 1

case "$lockfirst" in
	*cancelled) exit 1 ;;
	*y*) setsid -f slock ;;
esac

case "$target" in
	"suspend") systemctl suspend ;;
	"power off") systemctl poweroff ;;
	"reboot") systemctl reboot ;;
	"hibernate") systemctl hibernate ;;
	"hybrid sleep") systemctl hybrid-sleep ;;
	"suspend then hibernate") systemctl suspend-then-hibernate ;;
	*) echo "$0: unknown option: $target" ; exit 1
esac
