#!/bin/sh

if [ "${DISABLE_VOLUME_NOTIFICATIONS:+x}" = x ]; then
	exit
fi

if type wpctl >/dev/null 2>&1; then # WirePlumber/PipeWire
	if wpctl get-volume @DEFAULT_AUDIO_SINK@ | grep -Fq '[MUTED]'; then
		volumebar='muted'
	fi
	volumepercent="$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | cut -d' ' -f2 | sed 's|^0\.||; s|^1\.\([0-9]\{2\}\)$|1\1|; s|$|%|')"
elif type amixer >/dev/null 2>&1; then # ALSA
	if amixer get Master | grep Mono: | grep -Fq off; then
		volumebar='muted'
	fi
	volumepercent="$(amixer get Master | grep -F Mono: | grep -o '[0-9]\{1,3\}%')"
else # PulseAudio
	if pactl list sinks | grep -Fq 'Mute: yes'; then
		volumebar='muted'
	fi
	volumepercent="$(pactl list sinks | grep -m 1 '^\s*Volume:' | grep -o '[0-9]\{1,3\}%')"
fi

if [ "$volumebar" = muted ]; then
	notify-send -a 'volume-notifier' 'volume:' "muted"
else
	notify-send -a 'volume-notifier' 'volume:' "$volumepercent"
fi
